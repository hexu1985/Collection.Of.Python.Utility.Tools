(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{1734:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Rn}));var r,o,c,i=n(1410),a=n.n(i),s=n(133),u=n.n(s),l=n(39),d=n.n(l),b=n(31),p=n.n(b),f=n(33),m=n.n(f),h=n(72),O=n.n(h),g=n(49),j=n.n(g),v=n(22),x=n.n(v),y=n(0),C=n(1),k=n.n(C),T=n(123),w=n(1290),A=n(894),B=n(75),I=n(5),S=n(9),z=n(89),L=n.n(z),E=n(1471),D=n(1530),R=n(1735),M=n(55),G=n.n(M),P=n(40),N=n(1755),F=n(1813),K=n(909),_=n(1373),H=n(1819),U=n(289),W=n(27),V=n(797),Z=n.n(V),J=n(255),q=n.n(J),X=n(45),Y=n.n(X),$=n(250),Q=n.n($),ee=n(19),te=n(161),ne=n(42),re=n(1212),oe=n(1217),ce=n(285),ie=n(446),ae=n(1322),se=n(703),ue=n(1313),le=n(895),de=n(1814),be=n(1737),pe=n(1214),fe=n(1815),me=n(1215),he=n(1738),Oe=n(1816),ge=n(1301),je=n(1817),ve=n(1818),xe=n(1820),ye=n(1821),Ce=n(896),ke=n(3),Te=n(536),we=n(93),Ae=n(535),Be=n(61),Ie=n(180),Se=n(76),ze=n(1736),Le=n(229),Ee=n(1218),De=["children"],Re=["showConfirm"],Me=["sortType"],Ge=["liked","disabled","onClick"];function Pe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ne(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,c=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw c}}}}function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fe(e,t){var n=Object(C.useRef)(),r=Object(C.useRef)(),o=Object(C.useState)({}),c=x()(o,2)[1],i=Object(T.a)((function(e){e!==r.current&&(r.current="function"==typeof e?e(r.current):e,c({}))}));return function(e,t){return!e||!t||e.length!==t.length||e.some((function(e,n){return e!==t[n]}))}(n.current,t)&&(n.current=t,r.current=e()),[r.current,i]}var Ke=function(e){var t=e.isOpen,n=e.title,r=e.content,o=e.onOK,c=e.onCancel;return Object(y.b)(N.a,{title:n,closeButton:" ",maskClosable:!1,hotKeyClosable:!1,children:t&&Object(y.c)(y.a,{children:[Boolean(r)&&Object(y.b)(I.Text,{textAlign:"center",mb:"-15px",children:r}),Object(y.c)(F.a,{direction:"horizontal",children:[Object(y.b)(K.a,{onClick:c,children:"取消"}),Object(y.b)(K.a,{preset:"primary",color:"blue",onClick:o,children:"确定"})]})]})})},_e="https://www.zhihu.com/api/v4/comment_v5",He=function(e){var t,n;return(null===(n=null===(t=e.payload)||void 0===t?void 0:t.error)||void 0===n?void 0:n.message)||e.statusMessage||e.message},Ue=new W.b.Entity("comments"),We=new W.b.Array(Ue);Ue.define({childComments:We});var Ve,Ze,Je=function(e){return Object(W.a)(e,We)},qe=function(e){return{elementLocation:{block:{blockText:e}}}},Xe={root:"root_comment",sub:"child_comment",collapsed:"collapse_comments",reviewing:"reviewing_comments",anchor:"anchor_comment"},Ye=function(e){var t=e.resourceId,n=e.resourceType,r=e.onError,o=e.children,c=Object(U.b)(),i=Object(E.d)().cache,a=Object(C.useMemo)((function(){return function(e,t){return function(n){return function(r,o,c){return Array.isArray(r)?n([e,t].concat(j()(r)),o,c):n(r,o,c)}}}(n,t)}),[n,t]),s=Object(T.a)((function(e,r,o,c,a){var s,u,l=Object(E.c)([n,t,e,r,o]),d="".concat(l).concat(JSON.stringify(c||""),","),b=Pe(i.keys());try{for(b.s();!(u=b.n()).done;){var p=u.value;p.startsWith(l)&&p!==d&&function(){var e=(null===(s=i.get(p))||void 0===s?void 0:s.entities)||{};a.data=a.data.filter((function(t){return!e[t.id]}))}()}}catch(e){b.e(e)}finally{b.f()}})),u=Object(T.a)(function(){var e=O()(m.a.mark((function e(t,n,o,i,a,u){var l,d,b,p,f;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l="sub"!==o&&"anchor"!==o||!a?"".concat(t,"s/").concat(n):"comment/".concat(a),e.next=4,c("".concat(_e,"/").concat(l,"/").concat(Xe[o]),{query:{order_by:i,limit:20,offset:u}});case 4:return d=e.sent,s(o,i,a,u,d),b=Je(d.data),p=b.result,f=b.entities,d.data=p||[],d.entities=f.comments||{},e.abrupt("return",d);case 12:throw e.prev=12,e.t0=e.catch(0),null==r||r("commentFetchError",He(e.t0)),e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n,r,o,c,i){return e.apply(this,arguments)}}());return Object(y.b)(E.a,{value:{use:[a],fetcher:u,revalidateOnFocus:!1,errorRetryCount:3},children:o})},$e=Object(C.createContext)({}),Qe=function(e){var t=e.children,n=p()(e,De),r=n.resourceType,o=n.resourceId,c=n.onError,i=Object(B.b)().ZhihuHybrid,a=function(){var e=Object(C.useState)({isOpen:!1,title:""}),t=x()(e,2),n=t[0],r=n.isOpen,o=n.title,c=n.content,i=t[1],a=Object(B.b)().ZhihuHybrid,s=Object(C.useRef)(),u=Object(T.a)((function(e,t){return a?Object(P.a)("ui/showAlert").dispatch({title:e,content:t,affirm:"确定",dismiss:"取消"}).then((function(e){return"AFFIRM"===e.result})):(i({isOpen:!0,title:e,content:t}),new Promise((function(e){s.current=e})))}));return{isOpen:r,title:o,content:c,onOK:Object(T.a)((function(){var e;i({isOpen:!1,title:""}),null===(e=s.current)||void 0===e||e.call(s,!0),s.current=void 0})),onCancel:Object(T.a)((function(){var e;i({isOpen:!1,title:""}),null===(e=s.current)||void 0===e||e.call(s,!1),s.current=void 0})),showConfirm:u}}(),s=a.showConfirm,u=p()(a,Re),l=Object(C.useMemo)((function(){var e=n.onMessage,t=n.onError;return i&&(e=e||function(e){Object(P.a)("ui/showToast").dispatch({text:e})},t=t||function(e,t){Object(P.a)("ui/showToast").dispatch({text:t||e,icon:"fail"})}),Object.assign(Object.assign({showConfirm:s},n),{},{onMessage:e,onError:t})}),Object.values(n));return r&&o?Object(y.c)($e.Provider,{value:l,children:[Object(y.b)(Ye,{resourceType:r,resourceId:o,onError:c,children:t}),i||Object(y.b)(Ke,Object.assign({},u))]}):null},et=function(){return Object(C.useContext)($e)},tt=k.a.createContext({push:G.a,pop:G.a,changeLayerData:G.a,layers:[]}),nt=k.a.createContext({}),rt=function(e){var t=e.children,n=et(),r=n.shown,o=n.displayType,c=n.anchorCommentId,i=n.onClose,a=Fe((function(){if(!r)return[];var e=[{index:0,sortType:"score",commentType:"root",displayType:o}];return c&&e.push({index:1,sortType:"score",commentType:"anchor",displayType:"modal",fetchCommentId:c}),e}),[r,o,c]),s=x()(a,2),u=s[0],l=s[1],d=Object(T.a)((function(e){var t=e.sortType,n=p()(e,Me);l((function(e){return[].concat(j()(e),[Object.assign({index:e.length,sortType:t||"score",displayType:"modal"},n)])}))})),b=Object(T.a)((function(e){1===u.length?null==i||i():l("number"==typeof e?function(t){return t.slice(0,e+1)}:function(e){return e.slice(0,e.length-1)})})),f=Object(T.a)((function(e,t){l(Object(R.b)((function(n){n[t]=Object.assign(Object.assign({},n[t]),e)})))})),m={layers:u,push:d,pop:b,changeLayerData:f};return Object(y.b)(tt.Provider,{value:m,children:t})},ot=function(){return Object(C.useContext)(tt)},ct=Object(C.memo)((function(e){var t=e.data,n=e.children,r=ot(),o=r.changeLayerData,c=Object(T.a)((function(e){o(e,t.index)})),i=Object(T.a)((function(){return t.index===r.layers.length-1}));return t&&n?Object(y.b)(nt.Provider,{value:Object.assign(Object.assign({},t),{},{changeLayerData:c,isTopLayer:i,router:r}),children:n}):null})),it=function(){return Object(C.useContext)(nt)},at=function(e,t){var n=it(),r=n.displayType,o=n.commentType,c=n.sortType,i=n.fetchCommentId;return Object(E.b)([o,c,i,e],Object.assign({revalidateIfStale:Boolean("list"===r||(null==t?void 0:t.isInfinitePage))},t))},st=function(e,t){var n=e.data,r=e.customFetchKey,o=t.changePageData,c=t.sharedData;return o((function(e){var t;e.entities[n.id]=n,e.data.unshift(n.id),e.counts.totalCounts+=1,null===(t=c.onMessage)||void 0===t||t.call(c,"评论发布成功！")}),void 0,r)},ut=function(e,t){var n=t.pageOffset,r=t.layer,o=t.changePageData,c=r.commentType,i=r.sortType;""!==n&&o(e,void 0,[c,i,void 0,""])},lt=function(){var e=O()(m.a.mark((function e(t,n){var r,o,c,i,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,o=t.replyCommentId,c=t.customFetchKey,e.next=3,n.changePageData((function(e){e.entities[r.id]=r;var t=e.entities[o].replyRootCommentId,c=e.entities[t];e.counts.totalCounts+=1,t===o?(c.childComments.unshift(r.id),c.childCommentCount+=1):"root"===n.layer.commentType?c.childComments.splice(c.childComments.indexOf(o)+1,0,r.id):e.data.splice(e.data.indexOf(o)+1,0,r.id)}),void 0,c);case 3:null===(a=(i=n.sharedData).onMessage)||void 0===a||a.call(i,"评论发布成功！"),ut((function(e){e.counts.totalCounts+=1}),n);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),dt=function(e){var t=e.layer;(0,e.changePageData)(void 0,void 0,["root",t.router.layers[0].sortType,void 0,""],!0)},bt=function(e,t){var n=e.id,r=e.type,o=t.changePageData,c=t.fetcher,i=t.sharedData;return o(function(){var e=O()(m.a.mark((function e(t){var o,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.entities[n]["".concat(r,"d")],e.next=3,c("".concat(_e,"/comment/").concat(n,"/reaction/").concat(r),{method:a?"PUT":"DELETE"});case 3:"dislike"===r&&(null===(o=i.onMessage)||void 0===o||o.call(i,a?"已踩评论":"已取消踩"));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){var t=e.entities[n];if("like"===r)t.liked=!t.liked,t.disliked&&(t.disliked=!t.liked),t.likeCount+=t.liked?1:-1;else{t.disliked=!t.disliked;var o=t.liked;t.liked&&(t.liked=!t.disliked),o!==t.liked&&(t.likeCount+=t.liked?1:-1)}}))},pt=function(e,t){return bt({id:e,type:"like"},t)},ft=function(e,t){return bt({id:e.id,type:"dislike"},t)},mt=function(){var e=O()(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=Number(Y.a.get("zhihu::comment_replace_top_count"))||0)>=3)){e.next=3;break}return e.abrupt("return",!0);case 3:return Y.a.set("zhihu::comment_replace_top_count",n+1),e.next=6,t("确定替换已置顶的评论？","当前已有置顶评论，你只能置顶一条评论");case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ht=function(){var e=O()(m.a.mark((function e(t,n){var r,o,c,i,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.commentData,o=t.alreadyToppedId,c=n.changePageData,i=n.fetcher,a=n.layer,e.abrupt("return",c(function(){var e=O()(m.a.mark((function e(t){var n,c,a,s,u,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=7;break}return n=t.entities[o],e.next=4,i("".concat(_e,"/comment/").concat(o));case 4:(c=e.sent).childComments=n.childComments,t.entities[o]=c;case 7:a=Je([r]),s=a.result,u=a.entities,l=t.data.findIndex((function(e){return t.entities[e].top})),t.data.splice(l+1,0,s[0]),t.entities=Object.assign(Object.assign({},t.entities),u.comments);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),void 0,["root",a.sortType,void 0,""]));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ot=function(){var e=O()(m.a.mark((function e(t,n){var r,o,c,i,a,s,u,l,d;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.changePageData,c=n.getCache,i=n.sharedData,a=n.fetcher,s=n.layer,e.next=3,o(function(){var e=O()(m.a.mark((function e(n){var r,o,b,p;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.entities[t],o=r.isAuthorTop){e.next=12;break}if(b=c(["root",s.sortType,void 0,""]),l=null==b?void 0:b.data.find((function(e){return b.entities[e].isAuthorTop})),e.t0=l,!e.t0){e.next=10;break}return e.next=9,mt(i.showConfirm);case 9:e.t0=!e.sent;case 10:if(!e.t0){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,a("".concat(_e,"/comment/").concat(t,"/operation/top"),{method:o?"DELETE":"PUT"});case 14:p=e.sent,o?(p.childComments=r.childComments,n.entities[t]=p):(r.childComments.forEach((function(e){delete n.entities[e]})),delete n.entities[t],n.data=n.data.filter((function(e){return t!==e})),u=p),d=o?"已取消置顶":"已置顶";case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:u&&ht({commentData:u,alreadyToppedId:l},n),d&&(null===(r=i.onMessage)||void 0===r||r.call(i,d));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),gt=function(){var e=O()(m.a.mark((function e(t,n){var r,o,c,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,o=n.fetcher,c=n.changePageData,i=n.sharedData,e.next=4,i.showConfirm("你确定要删除这条评论吗？");case 4:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,c(function(){var e=O()(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("".concat(_e,"/comment/").concat(r),{method:"DELETE"});case 2:t.entities[r].isDelete=!0;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),jt=function(e,t){var n=e.id,r=t.fetcher;return(0,t.changePageData)(function(){var e=O()(m.a.mark((function e(t){var o,c,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.entities[n],c=o.hot,e.next=4,r("".concat(_e,"/comment/").concat(n,"/operation/hot"),{method:c?"DELETE":"PUT"});case 4:(i=e.sent).childComments=o.childComments,t.entities[n]=i;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},vt=function(){var e=O()(m.a.mark((function e(t,n){var r,o,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,o=n.changePageData,c=n.fetcher,e.next=4,o(function(){var e=O()(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.entities[r].collapsed,e.next=3,c("".concat(_e,"/comment/").concat(r,"/operation/collapse"),{method:n?"DELETE":"PUT"});case 3:n?(delete t.entities[r],t.data=t.data.filter((function(e){return e!==r})),t.counts.totalCounts-=1):t.entities[r].collapsed=!0;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:ut((function(e){e.counts.totalCounts-=1}),n),dt(n);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),xt=function(){var e=O()(m.a.mark((function e(t,n){var r,o,c,i,a,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.changePageData,o=n.fetcher,e.next=3,o("".concat(_e,"/comment/").concat(t,"/child_comment"));case 3:return c=e.sent,i=Je(c.data),a=i.entities.comments,s=i.result,e.abrupt("return",r((function(e){var n=e.entities[t];e.entities=Object.assign(Object.assign({},e.entities),a),n.childComments=q()(n.childComments,s)})));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),yt=function(e,t){t.sharedData.onReport(e)},Ct=function(){var e=O()(m.a.mark((function e(t,n){var r,o,c,i,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.sharedData,o=n.fetcher,e.next=3,r.showConfirm("确定屏蔽该用户吗？","屏蔽后，对方将不能关注你、向你发私信、评论你的实名回答、使用「@」提及你、邀请你回答问题，但仍然可以查看你的公开信息。");case 3:if(!e.sent){e.next=9;break}return a=t.author.urlToken,e.next=7,o("https://www.zhihu.com/api/v4/members/".concat(encodeURIComponent(a),"/actions/block"),{method:"POST"});case 7:null===(c=r.onMessage)||void 0===c||c.call(r,"屏蔽成功"),null===(i=r.onUserBlocked)||void 0===i||i.call(r,t.author);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),kt=function(e,t){var n,r=t.sharedData,o=document.createElement("span");o.innerHTML=e.content,Z()(o.innerText),null===(n=r.onMessage)||void 0===n||n.call(r,"已复制到剪贴板")},Tt={addComment:st,replyComment:lt,toggleLike:pt,toggleDislike:ft,toggleAuthorTop:Ot,toggleHot:jt,toggleCollapse:vt,deleteComment:gt,reviewComment:function(){var e=O()(m.a.mark((function e(t,n){var r,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.changePageData,o=n.fetcher,e.next=3,r(function(){var e=O()(m.a.mark((function e(n){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("".concat(_e,"/comment/").concat(t,"/operation/approve"),{method:"PUT"});case 2:delete n.entities[t],n.data=n.data.filter((function(e){return e!==t})),n.counts.totalCounts-=1;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:ut((function(e){e.counts.totalCounts-=1}),n),dt(n);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),expandChildComments:xt,report:yt,block:Ct,copy:kt},wt=function(){var e=O()(m.a.mark((function e(t,n){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n("".concat(_e,"/comment/").concat(t)));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),At={changeComment:function(){var e=O()(m.a.mark((function e(t,n){var r,o,c,i,a,s,u,l,b,p,f,h,O,g;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.type,o=t.data,c=n.layer,i=n.changePageData,a=n.fetcher,e.t0=r,e.next="addComment"===e.t0?5:"replyComment"===e.t0?10:"changeComment"===e.t0?18:26;break;case 5:return e.next=7,wt(o.commentId,a);case 7:return s=e.sent,st({data:s,customFetchKey:[c.commentType,c.sortType,void 0,""]},n),e.abrupt("return");case 10:if(u=o.commentId,l=o.replyCommentId,!Ve||Ve.id!==l){e.next=17;break}return b=Ve.key,e.next=15,wt(u,a);case 15:p=e.sent,lt({replyCommentId:l,data:p,customFetchKey:b},n);case 17:return e.abrupt("return");case 18:if(Ze){e.next=20;break}return e.abrupt("return");case 20:return h=(f=Ze).id,O=f.key,e.next=23,wt(h,a);case 23:return g=e.sent,i((function(e){var t=e.entities[h];g.childComments=t.childComments,g.childCommentCount=t.childCommentCount,e.entities=Object.assign(Object.assign({},e.entities),{},d()({},h,g))}),void 0,O),e.abrupt("return");case 26:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),clearWaiting:function(){Ve=void 0,Ze=void 0},replyComment:function(e,t){var n=e.replyCommentId,r=e.pageOffset,o=t.getCache,c=t.sharedData,i=t.layer,a=c.resourceType,s=c.resourceId,u=[i.commentType,i.sortType,i.fetchCommentId,r];Ve={key:u,id:n};var l=o(u),d=null==l?void 0:l.entities[n];if(d){var b=new URLSearchParams(Object(ee.decamelizeKeys)({replyCommentId:n,replyAuthorName:d.author.name})).toString().replace(/\+/g,"%20");Object(P.a)("base/openURL").dispatch({url:"".concat("zhihu://comment/editor","/").concat(a,"/").concat(s,"?").concat(b)})}},toggleLike:pt,toggleDislike:ft,toggleAuthorTop:Ot,toggleHot:jt,toggleCollapse:vt,deleteComment:gt,expandChildComments:xt,showCommentList:function(e,t){var n=e.commentType,r=e.rootCommentId,o=e.pageOffset,c=t.sharedData,i=t.layer,a=c.resourceType,s=c.resourceId;if(r){var u=i.sortType,l=i.fetchCommentId;Ze={key:[i.commentType,u,l,o],id:r}}var d=new URLSearchParams(Object(ee.decamelizeKeys)(Q()({listType:n,isChild:Boolean(r),rootCommentId:r},Boolean)));Object(P.a)("base/openURL").dispatch({url:"".concat("https://www.zhihu.com/comment/list","/").concat(a,"/").concat(s,"?").concat(d.toString())})},report:yt,block:Ct,copy:kt},Bt=function(){},It={addComment:Bt,replyComment:Bt,toggleLike:Bt,toggleDislike:Bt,toggleAuthorTop:Bt,toggleHot:Bt,toggleCollapse:Bt,deleteComment:Bt,reviewComment:Bt,expandChildComments:Bt,report:Bt,block:Ct,copy:kt},St=function(){var e=Object(U.b)(),t=et().onError;return Object(T.a)(O()(m.a.mark((function n(){var r,o=arguments;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.apply(void 0,o);case 3:return n.abrupt("return",n.sent);case 6:throw n.prev=6,n.t0=n.catch(0),r=n.t0,null==t||t("commentActionError",He(r),r),n.t0;case 11:case"end":return n.stop()}}),n,null,[[0,6]])}))))},zt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Object(B.b)(),n=t.ZhihuHybrid,r=t.Mobile,o=Object(E.d)(),c=o.mutate,i=o.cache,a=St(),s=it(),u=et(),l=u.resourceType,d=u.resourceId,b=s.commentType,p=s.sortType,f=s.fetchCommentId,m=Object(T.a)((function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return c(r?[l,d].concat(j()(r)):[l,d,b,p,f,e],t&&Object(R.a)(t),{optimisticData:n&&Object(R.a)(n),revalidate:o,populateCache:!n,rollbackOnError:!0})})),h=Object(T.a)((function(t){return i.get(Object(E.c)(t?[l,d].concat(j()(t)):[l,d,b,p,f,e]))}));return Object(T.a)((function(t,o){var i={changePageData:m,layer:s,fetcher:a,mutate:c,getCache:h,pageOffset:e,sharedData:u};return"string"==typeof t?(r?n?At:It:Tt)[t](o,i):t(i)}))},Lt={1:"评论区已关闭",2:"评论内容由作者筛选后展示",3:"因作者设置，评论区已关闭"},Et=function(e){var t=e.noComments,n=e.type,r=void 0===n?0:n,o=Object(B.b)().Mobile,c=it(),i=c.displayType,a=c.commentType,s="list"===i?{height:o?"168px":"400px"}:{height:"100%"};if(t){var u="root"===a||"sub"===a;return Object(y.b)(te.a.EI1,{image:"noWorks",content:u?"还没有评论，发表第一个评论吧":"无内容",preset:o?"compact":"normal",css:s})}return Object(y.b)(te.a.EI1,{image:"contentError",content:Lt[r],preset:o?"compact":"normal",css:s})},Dt=Object(C.createContext)(G.a),Rt=function(e){var t=e.pageOffset,n=e.isResourceAuthor,r=e.children,o=Object(B.b)().ZhihuHybrid,c=Object(C.useState)(!1),i=x()(c,2),a=i[0],s=i[1],u=Object(C.useState)(),l=x()(u,2),d=l[0],b=l[1],p=Object(C.useState)([]),f=x()(p,2),h=f[0],g=f[1],j=Object(C.useRef)(),v=it().displayType,k=et().authorInfo,w=zt(t),A=Object(T.a)((function(e,t,n,r){var o;null===(o=j.current)||void 0===o||o.trackEvent({eventType:"Click",action:"report"===t?"Report":void 0,elementLocation:{type:"Text",content:{type:"Comment",id:r},text:e,block:{blockText:n}}})})),z=Object(T.a)(function(){var e=O()(m.a.mark((function e(t,n){var r,c,i,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.id,i="modal"===v?"comment_popup":"comment_list",null===(r=j.current)||void 0===r||r.trackEvent({eventType:"Click",action:"Expand",elementLocation:{type:"Button",content:{type:"Comment",id:c},text:h.map((function(e){return x()(e,1)[0]})).join(" "),block:{blockText:i}}}),!o){e.next=10;break}return e.next=6,Object(P.a)("ui/showActionSheet").dispatch({items:t.map((function(e){var t=x()(e,2),n=t[0];return{id:t[1],text:n,data:{text:n}}}))});case 6:(a=e.sent).id&&(A(a.data.text,a.id,i,c),w(a.id,n)),e.next=12;break;case 10:g(t.map((function(e){var t=x()(e,2),r=t[0],o=t[1];return[r,function(){s(!1),A(r,o,i,c),w(o,n)}]}))),s(!0);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),L=Object(T.a)((function(e,t){if(a)s(!1);else{b(e);var r=t.author,o=t.isAuthor,c=t.disliked,i=t.hot,u=t.collapsed,l=t.canDislike,d=t.canHot,p=t.canCollapse,f=t.canDelete,m=r.id===(null==k?void 0:k.id)&&o,h=[!m&&["屏蔽","block"],!m&&["举报","report"],!m&&l&&[c?"取消踩":"踩评论","toggleDislike"],n&&d&&[i?"取消推荐":"推荐为热门","toggleHot"],n&&p&&[u?"取消折叠":"折叠评论","toggleCollapse"],(n||m)&&f&&["删除评论","deleteComment"],["复制","copy"]].filter(Boolean);z(h,t)}})),E=Object(T.a)((function(){s(!1)}));return Object(y.c)(y.a,{children:[Object(y.b)(Dt.Provider,{value:L,children:r}),Object(y.b)(S.e,{ref:j}),o||Object(y.b)(_.a,{globalClose:!0,placement:"bottom",target:d,isOpen:a,onClose:E,children:Object(y.b)(I.Box,{py:"5px",children:h.map((function(e){var t=x()(e,2),n=t[0],r=t[1];return Object(y.b)(I.Flex,{onClick:r,alignItems:"center",justifyContent:"center",width:"95px",height:"40px",fontSize:"14px",color:"GBL05A",sx:{cursor:"pointer",":hover":{background:"GBK10A"}},children:n},n)}))})})]})},Mt=Object(C.createContext)({}),Gt=function(e){var t=e.data,n=e.children;return Object(y.b)(Mt.Provider,{value:t,children:n})},Pt={score:"默认",ts:"时间"},Nt={root:function(e){return e.totalCounts?"".concat(e.totalCounts," 条评论"):"暂无评论"},sub:function(){return"评论回复"},collapsed:function(e){return e.totalCounts?"".concat(e.totalCounts," 条已折叠评论"):"暂无评论"},reviewing:function(e){return e.totalCounts?"".concat(e.totalCounts," 条待筛选评论"):"暂无评论"},anchor:function(){return"返回评论"}},Ft=function(e){var t=e.title,n=e.children,r=Object(B.b)().Mobile;return Object(y.c)(I.Flex,{flex:"0 0 auto",px:r?0:"20px",height:r?"31px":"50px",alignItems:"center",justifyContent:"space-between",sx:r?null:Object(re.a)({borderBottom:"1px solid",borderBottomColor:"GBK09A"}),children:[Object(y.b)(I.Text,{fontSize:"15px",color:"GBK03A",fontWeight:"bold",children:t}),n]})},Kt=Object(C.memo)((function(e){var t=e.title,n=e.counts,r=e.onChangeSortType,o=et(),c=o.targetLink,i=o.hideSort,a=it(),s=a.commentType,u=a.index,l=a.sortType,d=a.changeLayerData,b=a.router,p="modal"===et().displayType?u>0:u>1,f=t||Object(y.c)(I.Text,{onClick:p?b.pop.bind(void 0,void 0):void 0,css:{cursor:p?"pointer":"default"},children:[p&&Object(y.b)(ae.b,{center:!0,size:24}),Nt[s](n||{})]});return Object(y.c)(Ft,{title:f,children:[0===u&&Object(y.b)(I.Flex,{flex:"1 1 auto",children:c}),Boolean(!i&&n&&"root"===s)&&Object(y.b)(I.Flex,{fontSize:"12px",lineHeight:"24px",fontWeight:"bold",bg:"GBK10A",sx:{border:"2px solid",borderColor:"GBK10A",borderRadius:"3px"},children:["score","ts"].map((function(e){return Object(y.b)(S.a,{as:I.Box,zaType:"Button",zaText:!0,view:qe("sort"),width:"50px",height:"24px",bg:e===l?"GBK99A":"transparent",sx:{color:l===e?"GBK02A":"GBK05A",borderRadius:"2px",textAlign:"center",cursor:"pointer"},onClick:function(){null==r||r(e),d({sortType:e,prevLayerOffset:void 0})},children:Pt[e]},e)}))})]})})),_t=function(e){var t=e.id,n=e.urlToken,r=e.children,o=Object(B.b)().Mobile,c=et().userHoverCard;return o||!c?r:Object(y.b)(c,{id:t,urlToken:n,toggler:k.a.cloneElement(r,{key:t})})},Ht=Object(C.memo)((function(e){var t=e.user,n=t.avatarUrl,r=t.isOrg,o=t.id,c=t.name,i="0"===o||""===o,a=Object(B.b)().Mobile,s=Object(y.b)(Te.b,{url:i?Te.a:n,alt:c,size:a?30:24,round:a,css:Object.assign(Object.assign({},Object(oe.a)()),{},{flex:"0 0 auto"}),loading:"lazy"});return i?s:Object(y.b)(I.Box,{flex:"0 0 auto",children:Object(y.b)(_t,{id:o,children:Object(y.b)(we.b,{href:"https://www.zhihu.com/".concat(r?"org":"people","/").concat(o),target:"_blank",zaType:"Button",zaText:"头像",css:{height:a?"30px":"24px",width:a?"30px":"24px"},children:s})})})})),Ut=Object(C.createContext)([]),Wt=function(e){var t=e.children,n=Object(C.useState)([]),r=x()(n,2),o=r[0],c=r[1];return Object(C.useEffect)((function(){Object(Ae.c)().then((function(e){c(e)}))}),[]),Object(y.b)(Ut.Provider,{value:o,children:t})},Vt=function(){return Object(C.useContext)(Ut)},Zt=function(e){var t=e.className,n=e.height,r=e.width,o=e.url,c=e.onClick,i=Object(C.useMemo)((function(){return function(e,t){var n=parseInt(t,10)||120,r=parseInt(e,10)||120,o=Math.max(120,Math.min(202,r)),c=Math.max(120,Math.min(202,n)),i=Math.min(Math.max(r/n,.5),2);return{width:i>1?o:c*i,height:i>1?o/i:c,ratio:i}}(r,n)}),[r,n]),a=i.width,s=i.height,u=i.ratio,l=Object(C.useMemo)((function(){return o.endsWith("gif")?[o,o]:[Object(Be.imgUrl)(o,"xld"),Object(Be.imgUrl)(o,"")]}),[o]),d=x()(l,2),b=d[0],p=d[1],f=Object(T.a)((function(e){null==c||c(e,p)}));return Object(y.b)(I.Box,{width:a,height:s,sx:{backgroundColor:"GBK10B",position:"relative",borderRadius:"8px"},className:t,children:Object(y.b)("img",{alt:"",src:b,"data-rawwidth":r||a,"data-rawheight":n||a,"data-original":p,css:{width:"100%",height:"100%",borderRadius:"8px",objectFit:"cover",cursor:"zoom-in",objectPosition:u<1?"center top":"unset"},loading:"lazy",onClick:f})})},Jt=function(e){var t=e["data-height"],n=e["data-width"],r=e.className,o=e.href,c=Object(B.b)().ZhihuHybrid,i=et().onShowImage,a=Object(T.a)((function(e,t){c&&!i?Object(P.a)("base/openImage").dispatch({images:[t]}):null==i||i(t,e.currentTarget)}));return Object(y.b)(Zt,{height:t,width:n,url:o,css:{marginTop:"12px"},className:r,onClick:a})},qt=function(e){var t=e.href,n=e["data-hash"],r=e.children;return Object(y.b)(_t,{id:n,children:Object(y.b)(we.b,{href:t,target:"_blank",className:"member_mention",children:r})})},Xt=function(e,t){return Object(Ae.a)(e,{convertEmoticon:!0,emoticonList:t,traverseCallback:function(e,t){if(e.nodeType===Node.ELEMENT_NODE){var n=e.classList,r=e.textContent;if(n.contains("member_mention"))return t(qt);if(n.contains("comment_img")||n.contains("comment_sticker"))return t(Jt);if(null==r?void 0:r.match("http"))return t("A"===e.tagName?we.b:void 0)}return t()}})},Yt=function(e){var t=e.data,n=e.commentType,r=Vt(),o=t.content,c=t.isDelete,i=t.collapsed,a=Object(C.useMemo)((function(){if("collapsed"!==n){if(c)return[!0,"该条评论已删除"];if(i)return[!0,"该条评论被折叠"]}else if("collapsed"===n&&c)return[!0,"该条评论已删除"];return[!1,Xt(o,r)]}),[n,c,i,o,r]),s=x()(a,2),u=s[0],l=s[1];return Object(y.b)(I.Text,{className:"CommentContent",mt:"4px",fontSize:"15px",lineHeight:"21px",sx:{color:u?"GBL05A":"GBK03A",overflowWrap:"break-word",p:{margin:0},".sticker":{width:"20px",height:"20px",marginBottom:"-4px"},".member_mention":{color:"GBL07A"},"a.internal,a.external":{textDecoration:"none",color:"GBK03A",borderBottom:"1px solid",borderColor:"GBK03A",":hover":{color:"GBL07A",borderBottom:"1px solid",borderColor:"GBL07A"},".invisible":{display:"none"},".ellipsis::after":{content:'"..."'}}},children:l})},$t=Object(C.memo)((function(e){var t=e.text;return Object(Ae.d)(t)})),Qt=function(e){var t=e.data,n=e.responseLink,r=e.richText,o=e.className,c=Object(ce.a)(),i=c.colors,a=i.GBK06A,s=i.GBK08A,u=i.GBL01A,l=c.isDarkMode,d=t.text,b=t.color,p=t.nightColor,f=t.hasBorder,m=t.borderColor,h=t.borderNightColor,O=t.targetLink,g=n&&O,j=g?we.b:"span";return Object(y.c)(j,{css:Object.assign(Object.assign(Object.assign({},f&&Object.assign(Object.assign({},Object(re.a)({border:"1px solid ".concat((l?h:m)||s),borderRadius:"4px"})),{},{padding:"0 4px"})),{},{color:(l?p:b)||a},g&&{textDecoration:"none"}),{},{height:"16px",fontSize:"12px",lineHeight:"16px",boxSizing:"border-box","& a":{color:u,textDecoration:"none"}}),className:o,href:g?O:"",children:[r?Object(y.b)($t,{text:d}):d,Boolean(O)&&Object(y.b)(se.b,{css:{fill:b,marginRight:"-2px"},center:!0,size:12})]})},en=function(e){var t=e.data,n=Object(B.b)().Mobile,r=Object(ce.a)().isDarkMode,o=et().onNeedVip;if(!t)return null;var c=t.vipIcon,i=(c=void 0===c?{}:c).url,a=c.nightModeUrl,s=t.isVip;return i&&s?Object(y.b)(I.Image,{src:r?a:i,size:n?14:16,css:{cursor:"pointer",marginLeft:"4px"},onClick:function(){o("vip_badge")}}):null},tn=function(e){var t=e.user,n=Object(B.b)().Mobile,r=t.id,o=t.name,c=t.isOrg;return"0"===r||""===r?Object(y.b)("span",{children:o}):Object(y.b)(_t,{id:r,children:Object(y.b)(we.b,{href:"https://www.zhihu.com/".concat(c?"org":"people","/").concat(r),target:"_blank",css:function(e){return{fontSize:n?"14px":"15px",fontWeight:"bold",textDecoration:"none",color:e.colors.GBK03A}},children:o})})},nn=function(e){var t=e.user,n=e.authorTag,r=e.isReplyTo,o=t.badge,c=t.badgeV2,i=t.vipInfo,a=Object(B.b)().Mobile;return Object(y.c)(I.Flex,{alignItems:"center",height:"16px",children:[Object(y.b)(tn,{user:t}),Boolean(r)||Object(y.c)(y.a,{children:[null==n?void 0:n.map((function(e){return Object(y.b)(Qt,{data:e,css:{marginLeft:"4px",fontSize:a?"10px":"12px"}},e.text)})),Object(y.b)(Ie.c,{size:a?16:18,badge:null!=c?c:o,css:{marginLeft:"4px"}}),Object(y.b)(en,{data:i})]})]})},rn=function(e){var t=e.onClick,n=et().authorInfo;return(null==n?void 0:n.id)?Object(y.b)(ue.d,{size:16,css:{margin:"2px",cursor:"pointer"},onClick:t}):null},on=function(e){var t=e.id,n=e.author,r=e.childComments,o=e.childCommentCount,c=e.pageOffset,i=e.onAction,a=Object(ce.a)().colors.GBL05A,s=Object(B.b)().Mobile,u=o>(null==r?void 0:r.length),l=o<=5,d=Object(T.a)((function(){l?i("expandChildComments",t):s?i("showCommentList",{rootCommentId:t,pageOffset:c}):i((function(e){e.layer.router.push({commentType:"sub",sortType:"ts",fetchCommentId:t,rootCommentAuthor:n,prevLayerOffset:c})}))}));return u?Object(y.c)(S.a,{as:K.a,shouldTrackShow:!0,zaType:"Block",zaAction:"Expand",view:qe("show_reply"),preset:"secondary",color:"grey",onClick:d,css:s?function(e){return{margin:"10px 0 10px 54px",padding:"0 10px 0 16px",fontSize:"12px",borderRadius:"14px",height:"28px",lineHeight:"28px",background:e.colors.GBK10A,color:e.colors.GBK03A,svg:{marginBottom:"1px"}}}:{margin:"10px 0 10px 54px",padding:"0 6px 0 12px",height:"32px",color:a,fontWeight:500,svg:{marginBottom:"1px"}},children:[l?"展开其他 ".concat(o-r.length," 条回复"):"查看全部 ".concat(o," 条回复"),Object(y.b)(le.b,{center:!0,size:s?20:24})]}):null},cn=function(e){var t=e.data,n=t.author,r=t.authorTag,o=t.replyToAuthor,c=t.replyAuthorTag;return Object(y.c)(I.Flex,{alignItems:"center",flex:"0 0 auto",children:[Object(y.b)(nn,{user:n,authorTag:r}),o&&Object(y.b)(de.a,{size:12,css:{margin:"0 4px"}}),o&&Object(y.b)(nn,{user:o,isReplyTo:!0,authorTag:c})]})},an=function(e){var t=e.isReply,n=e.isSticky,r=e.autoFocus,o=e.replyCommentId,c=e.localCache,i=e.disabled,a=e.placeholder,s=e.maxLine,u=e.onSubmit,l=e.className,d=Object(C.useRef)(),b=et(),p=b.authorInfo,f=b.resourceType,m=b.resourceId,h=b.onNeedLogin,O=b.onNeedVip,g=b.onError,j=Vt(),v=t?void 0:n?"悬浮":"常驻",x=t?"reply_comment":"direct_comment",k=Object(T.a)((function(e){var t;null===(t=d.current)||void 0===t||t.trackEvent({eventType:"Click",action:"Comment",elementLocation:{type:"Button",text:v,block:{blockText:x}}}),u(e)}));return Object(y.c)(y.a,{children:[Object(y.b)(S.e,{ref:d}),Object(y.b)(S.f,{zaType:"Block",zaText:v,view:qe(x),children:Object(y.b)(ze.a,{className:l,authorInfo:p,resourceType:f,resourceId:m,isReply:t,disabled:i,autoFocus:r,placeholder:a,localCache:c,replyCommentId:o,maxLine:s,emoticonList:j,onSubmit:k,onNeedLogin:h,onNeedPurchaseVip:O,onError:g})})]})},sn=Object(Le.a)(K.a),un=function(e){var t=e.liked,n=e.disabled,r=e.onClick,o=p()(e,Ge),c=Object(ce.a)().colors.GBK06A,i=Object(B.b)().Mobile,a=Object(Ee.a)(),s=Object(w.a)(function(){var e=O()(m.a.mark((function e(o){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return e.abrupt("return");case 2:if(null==r||r(o),!i||t){e.next=9;break}return Object(P.a)("iOS/hapticFeedback").dispatch(),e.next=7,a.start({scale:1.3,transition:{type:"tween",duration:.2,ease:[0,0,.58,1]}});case 7:return e.next=9,a.start({scale:1,transition:{type:"tween",duration:.3,ease:[.42,0,.2,1.8]}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),300,{leading:!0,trailing:!1});return Object(y.b)(sn,Object.assign(Object.assign({},o),{},{initial:{scale:1},animate:a,css:Object.assign(Object.assign({},i&&{color:t?void 0:c,fontSize:"12px",svg:{fontSize:"16px"}}),n&&{cursor:"default",opacity:"0.5"}),onClick:s}))},ln=function(e){var t=Object(B.b)().Mobile,n=Object(w.a)(e.onClick||G.a,300,{leading:!0,trailing:!1});return Object(y.b)(K.a,Object.assign(Object.assign({},e),{},{onClick:n},t?{label:"",css:function(e){return{svg:{fontSize:"16px"},color:e.colors.GBK06A}}}:null))},dn=function(e){var t,n=e.data,r=e.subIntro,o=e.commentType,c=e.pageOffset,i=e.onAction,a=n.id,s=n.createdTime,u=n.commentTag,l=n.canReply,d=n.canLike,b=n.isAuthorTop,p=n.canAuthorTop,f=n.liked,m=n.likeCount,h=n.reviewing,O=n.collapsed,g=n.author,j=Object(B.b)().Mobile,v=et().authorInfo,k=!r&&!h&&!O&&l,w=g.id!==(null==v?void 0:v.id)&&d,A=!h&&!O&&p,z=Object(C.useState)(!1),L=x()(z,2),E=L[0],D=L[1],R=Object(T.a)((function(){j?i("replyComment",{replyCommentId:a,pageOffset:c}):D(!E)})),M=Object(T.a)((function(e){D(!1),i("replyComment",{replyCommentId:a,data:e,pageOffset:c})})),G=Object(T.a)((function(){i("toggleLike",a)})),P=Object(T.a)((function(){i("reviewComment",a)})),N=Object(T.a)((function(){i("toggleAuthorTop",a)}));return t=!h||"root"!==o&&"sub"!==o?Object(y.c)(I.Flex,{alignItems:"center",flex:"0 0 auto",css:{".Button":{marginLeft:"16px"}},children:[k&&Object(y.b)(S.a,{as:ln,zaType:"Card",zaAction:"Comment",preset:"plain",icon:j?be.b:pe.b,label:"回复",onClick:R}),h&&Object(y.b)(S.a,{as:ln,zaType:"Button",zaText:!0,preset:"plain",icon:fe.a,label:"公开此评论",onClick:P}),!h&&!O&&Object(y.b)(S.a,{as:un,zaType:"Card",zaAction:f?"UnUpvote":"Upvote",preset:"plain",disabled:!w,icon:!j||f?me.b:he.b,label:m?String(m):"赞",color:f?"blue":"grey",liked:f,onClick:G}),A&&Object(y.b)(S.a,{as:ln,shouldTrackShow:!0,zaType:"Button",zaText:!0,preset:"plain",icon:j?b?Oe.a:ge.c:b?je.a:ve.a,label:b?"取消置顶":"置顶",onClick:N})]}):null,Object(y.c)(y.a,{children:[Object(y.c)(I.Flex,{alignItems:"center",justifyContent:"space-between",mt:"4px",children:[Object(y.c)(I.Flex,{alignItems:"center",flex:"0 0 auto",fontSize:j?"12px":"14px",color:"GBK06A",children:[Object(y.b)(I.Text,{mr:"4px",children:Object(Se.toSmartString)(s)}),u.map((function(e){return Object(y.c)(C.Fragment,{children:[Object(y.b)("span",{children:" · "}),Object(y.b)(Qt,{data:e,css:{fontSize:j?"12px":"14px",margin:"0 4px"}})]},e.type)}))]}),t]}),E&&Object(y.b)(an,{isReply:!0,autoFocus:!0,localCache:!0,placeholder:"回复 ".concat(g.name),replyCommentId:a,onSubmit:M,css:{marginTop:"8px"}})]})},bn=function(e){var t=e.enable,n=e.clickDelay,r=void 0===n?300:n,o=e.longPressDelay,c=void 0===o?800:o,i=e.onPress,a=e.onLongPress,s=e.children,u=Object(C.useRef)(0),l=Object(C.useRef)();var d=Object(w.a)(i,r,{leading:!0,trailing:!1}),b=Object(T.a)((function(e){for(var t=e.target;t!==e.currentTarget;){if(["A","SVG","BUTTON","IMG"].includes(t.tagName.toUpperCase()))return!1;t=t.parentElement}return!0})),p=Object(T.a)((function(){clearTimeout(l.current),l.current=void 0,u.current=0})),f=Object(T.a)((function(e){u.current=Date.now(),l.current=setTimeout((function(){a(e),p()}),c)})),m=Object(T.a)((function(e){l.current&&(Date.now()-u.current<r&&b(e)&&d(e),p())}));return t?Object(y.b)(I.Box,{css:{userSelect:"none"},onTouchStart:f,onTouchEnd:m,onTouchMove:p,children:s}):Object(y.b)(y.a,{children:s})},pn=Object(ke.h)(r||(r=u()(["\n  0%, 100% {background-color: rgba(255,255,255,1);}\n  50% {background-color: rgba(0,102,255,.08);}\n"]))),fn=Object(ke.h)(o||(o=u()(["\n  0%, 100% {background-color: rgba(0,0,0,1);}\n  50% {background-color: rgba(85, 142, 255,.08);}\n"]))),mn=Object(C.memo)(Object(C.forwardRef)((function(e,t){var n=e.className,r=e.data,o=e.commentType,c=e.sub,i=e.subIntro,a=e.blink,s=e.pageOffset,u=e.onAction,l=r.id,d=r.author,b=r.isDelete,p=r.childComments,f=r.childCommentCount,m=Object(B.b)().Mobile,h=Object(C.useContext)(Dt),O=Object(w.a)((function(e){h(e.currentTarget,r)}),300,{leading:!0,trailing:!1}),g=Object(T.a)((function(){u("replyComment",{replyCommentId:l,pageOffset:s})}));return Object(y.c)("div",{ref:t,children:[Object(y.b)(S.b,{content:{type:"Comment",id:l},children:Object(y.b)(bn,{enable:m&&!b,onPress:g,onLongPress:O,children:Object(y.c)(S.f,{as:I.Flex,zaType:"Card",extra:{configMap:{commentLevel:c?"2":"1"}},css:function(e){return{animation:a?"".concat(e.isDarkMode?fn:pn," 1s linear forwards"):void 0,padding:m?"10px 0 6px ".concat(c?"40px":0):"10px 20px 14px ".concat(c?"54px":"20px")}},className:n,children:[Object(y.b)(Ht,{user:d}),Object(y.c)(I.Box,{ml:"10px",flex:"1 1 auto",children:[Object(y.c)(I.Flex,{justifyContent:"space-between",color:"GBK06A",children:[Object(y.b)(cn,{data:r}),Object(y.b)(rn,{onClick:O})]}),Object(y.b)(Yt,{data:r,commentType:o}),Object(y.b)(dn,{data:r,subIntro:i,commentType:o,pageOffset:s,onAction:u})]})]})})}),Boolean(i)||(null==p?void 0:p.map((function(e){return Object(y.b)(hn,{id:e,sub:!0,commentType:o,pageOffset:s,onAction:u},e)}))),Boolean(i)||Object(y.b)(on,{id:l,author:d,childComments:p,childCommentCount:f,pageOffset:s,onAction:u})]})}))),hn=Object(C.forwardRef)((function(e,t){var n,r=(n=e.id,Object(C.useContext)(Mt)[n]);return Object(y.b)(mn,Object.assign(Object.assign({ref:t},e),{},{data:r}))})),On=function(e){var t=e.pageOffset,n=e.rootCommentId,r=at(t).data,o=zt(t);return r&&n?Object(y.c)(Gt,{data:r.entities,children:[Object(y.b)(hn,{id:n,commentType:"sub",pageOffset:t,subIntro:!0,css:function(e){return{padding:"20px",background:e.colors.GBK99A,borderBottom:"20px solid ".concat(e.colorMod(e.colors.GBL05A).alpha(.1))}},onAction:o}),Object(y.b)(Ft,{title:"".concat(Object(ne.cnNiceNumber)(r.entities[n].childCommentCount),"条回复")})]}):null},gn=function(e){var t=e.isResourceAuthor,n=it(),r=n.prevLayerOffset,o=void 0===r?"":r,c=n.fetchCommentId,i=n.router.layers,a=n.displayType,s=Object(C.useState)((function(){return Object.assign(Object.assign({},i[0]),{},{displayType:a})})),u=x()(s,1)[0];return Object(y.b)(ct,{data:u,children:Object(y.b)(Rt,{pageOffset:o,isResourceAuthor:t,children:Object(y.b)(On,{pageOffset:o,rootCommentId:c})})})},jn=Object(C.memo)((function(e){var t=e.containerRef,n=e.className,r=e.commentType,o=e.scrollAndBlink,c=e.list,i=e.entities,a=e.paging,s=e.counts,u=e.pageOffset,l=e.isInfinite,d=e.onNextPage,b=e.onAction,p=Object(C.useRef)(null),f=Object(C.useRef)(null),m=Object(C.useRef)(null),h=Object(B.b)(),O=h.ZhihuHybrid,g=h.Mobile,j=Object(C.useMemo)((function(){return o?"last"===o?c.length-1:c.findIndex((function(e){return e===o})):-1}),[c,o]);return Object(A.a)((function(){-1!==j&&t.current&&p.current&&f.current&&t.current.scrollTo({top:p.current.offsetTop+f.current.offsetTop-10})})),Object(C.useEffect)((function(){if(l&&!a.isEnd&&m.current){var e=new IntersectionObserver((function(e){if(e[0].isIntersecting&&a.next){var t=new URL(a.next).searchParams.get("offset");null==d||d(t)}}),{root:O?void 0:t.current,rootMargin:"0px 0px 200px 0px"});return e.observe(m.current),function(){e.disconnect()}}}),[l,a,d,O,t]),Object(y.c)(I.Box,{ref:p,className:n,children:[Object(y.b)(Gt,{data:i,children:c.map((function(e,t){var n=t===j;return Object(y.b)(hn,{ref:n?f:void 0,id:e,commentType:r,pageOffset:u,blink:n,onAction:b},e)}))}),g&&a.isEnd&&0===(null==s?void 0:s.collapsedCounts)&&Object(y.b)(I.Box,{mt:"20px",color:"GBK06A",fontSize:"13px",textAlign:"center",children:"没有更多评论了"}),Object(y.b)("div",{ref:m})]})})),vn=Object(ke.h)(c||(c=u()(["\n0% {transform: translateX(-56%);}\n100% {transform: translateX(56%);}\n"]))),xn=function(e){var t=e.className,n=Object(ce.a)().colors,r=n.GBK10A,o=n.GBK09A,c=n.GBK99A;return Object(y.c)("div",{className:t,css:{position:"relative",overflow:"hidden",background:r,color:c},children:[Object(y.b)("div",{css:{position:"absolute",width:"200%",height:"100%",background:"linear-gradient(to right, ".concat(r," 0%, ").concat(o," 20%, ").concat(r," 40%, ").concat(r," 100%)"),animation:"".concat(vn," 1s linear 1ms infinite forwards")}}),Object(y.b)("svg",{width:"656",height:"44",viewBox:"0 0 656 44",css:{position:"relative",minWidth:"100%",verticalAlign:"top",boxSizing:"border-box"},children:Object(y.b)("path",{d:"M0 0h656v44H0V0zm0 0h480v12H0V0zm0 32h238v12H0V32z",fill:"currentColor",fillRule:"evenodd"})})]})},yn=function(e){var t=e.isInfinite,n=e.fullHeight;return t?Object(y.b)("div",{css:{boxSizing:"border-box",padding:"10px 20px 14px 20px",height:n?"calc(100vh - 24px * 2 - 50px - 62px - 20px)":void 0},children:Object(y.b)(xn,{})}):Object(y.b)(I.Flex,{justifyContent:"center",alignItems:"center",height:"96px",children:Object(y.b)(H.a,{})})},Cn=function(e){var t=e.containerRef,n=e.commentType,r=e.scrollAndBlink,o=e.fullHeightLoading,c=e.pageOffset,i=e.isResourceAuthor,a=e.isInfinite,s=e.onNextPage,u=at(c,{isInfinitePage:a}),l=u.data,d=u.isValidating,b=zt(c);if(d&&!l)return Object(y.b)(yn,{isInfinite:a,fullHeight:o});var p=l||{},f=p.data,m=p.entities,h=p.paging,O=p.counts;return f&&f.length>0&&m&&h&&O?Object(y.b)(Rt,{pageOffset:c,isResourceAuthor:i,children:Object(y.b)(jn,{containerRef:t,commentType:n,scrollAndBlink:r,list:f,entities:m,paging:h,counts:O,pageOffset:c,isInfinite:a,onNextPage:s,onAction:b})}):null},kn=function(e){var t=e.paging,n=Object(C.useMemo)((function(){return t?[t.isEnd,new URL(t.next).searchParams.get("offset")||void 0]:[!0]}),[t]),r=x()(n,2),o=r[0],c=r[1],i=it(),a=i.sortType,s=i.router,u=Object(T.a)((function(){!o&&c&&s.push({commentType:"root",sortType:a,prevLayerOffset:c})}));return o?null:Object(y.c)(S.a,{as:I.Flex,zaType:"Button",zaAction:"Expand",shouldTrackShow:!0,zaText:"查看全部评论",css:function(e){return Object.assign({alignItems:"center",justifyContent:"center",color:e.colors.GBL05A,fontSize:"15px",padding:"20px 0",margin:"0 20px",cursor:"pointer"},Object(re.a)({borderTop:"1px solid ".concat(e.colors.GBK10A)}))},onClick:u,children:[Object(y.b)(I.Text,{children:"点击查看全部评论"}),Object(y.b)(le.b,{size:24})]})},Tn=Object(C.memo)((function(e){var t=e.type,n=e.counts,r=e.isResourceAuthor,o=e.onAction,c=Object(B.b)().Mobile,i=ot().push,a=Object(T.a)((function(){r&&(c?o("showCommentList",{commentType:"review"}):i({commentType:"reviewing"}))})),s=Object(T.a)((function(){c?o("showCommentList",{commentType:"collapsed"}):i({commentType:"collapsed"})}));if(!n)return null;if("reviewing"===t){var u=r&&n.reviewingCounts>0;return Object(y.c)(S.a,{as:I.Flex,shouldTrackShow:!0,zaType:"Button",zaAction:"Expand",zaText:!0,css:function(e){return{flex:"0 0 auto",alignItems:"center",margin:c?"20px 0 0":"20px 20px 0",padding:"0 10px",height:"36px",fontSize:"14px",color:r?e.colors.GBL01A:e.colors.GBL05A,borderRadius:"3px",backgroundColor:e.colorMod(r?e.colors.GBL01A:e.colors.GBL05A).alpha(.1),cursor:u?"pointer":"default"}},onClick:u?a:G.a,children:[Object(y.b)(xe.a,{text:!0,size:16}),Object(y.b)(I.Text,{ml:"8px",flex:"1 1 auto",children:r?"".concat(n.reviewingCounts," 条新评论待筛选"):"评论内容由作者筛选后展示"}),u&&Object(y.b)(le.b,{size:24})]})}return"collapsed"===t&&n.collapsedCounts>0?Object(y.c)(I.Flex,{alignItems:"center",justifyContent:"center",color:"GBL05A",fontSize:"15px",p:c?"0 0 10px 0":"20px 0",mx:"20px",sx:Object.assign(Object.assign({},c?void 0:Object(re.a)({borderTop:"1px solid",borderTopColor:"GBK10A"})),{},{cursor:"pointer"}),onClick:s,children:[Object(y.b)(I.Text,{children:"查看被折叠评论"}),Object(y.b)(ye.a,{size:16,css:{marginLeft:"4px"},onClick:function(e){e.stopPropagation(),window.open("https://www.zhihu.com/question/52029856/answer/128623557")}})]}):null})),wn=function(e){return{flex:"0 0 auto",padding:"10px 20px",boxShadow:"0px -1px 3px ".concat(e.colorMod(e.colors.GBK02B).alpha(.12))}},An=function(){var e=et(),t=e.hideFoldButton,n=e.onClose;return t||!n?null:Object(y.b)(Le.a.div,{variants:{initial:{opacity:0,transitionEnd:{display:"none"}},sticky:{opacity:1,display:"block"},unSticky:{opacity:0,transitionEnd:{display:"none"}}},css:{position:"absolute",top:"-52px",right:"20px"},children:Object(y.c)(K.a,{preset:"secondary",color:"grey",onClick:n,css:function(e){return{margin:"10px 0 10px 54px",padding:"0 6px 0 12px",height:"32px",color:e.colors.GBL05A,backgroundColor:e.colors.GBK10A,fontWeight:500,":hover":{backgroundColor:e.colors.GBK10A},svg:{marginBottom:"1px"}}},children:["收起评论",Object(y.b)(Ce.b,{center:!0,size:24})]})})},Bn=function(e){var t=e.disabled,n=e.autoFocus,r=e.placeholder,o=e.onSubmit,c=e.children,i=et().hideBottomEditorShadow,a=Object(C.useRef)(null),s=Object(C.useRef)(null),u=Object(C.useRef)(null),l=Object(C.useState)(!1),d=x()(l,2),b=d[0],p=d[1],f=Object(Ee.a)(),h=Object(ce.a)().colors,g=h.GBK99A,j=h.GBK02B;return Object(C.useEffect)((function(){if(a.current){var e=a.current.offsetHeight;p(e>1.5*window.innerHeight)}}),[c]),Object(C.useEffect)((function(){if(b&&a.current&&s.current&&u.current){var e=function(){var e=O()(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.set(t?"unSticky":"sticky"),e.next=3,f.start(t?"sticky":"unSticky");case 3:t||f.set("initial");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t=new IntersectionObserver((function(t){var n=x()(t,2),r=n[0],o=n[1];2===t.length||!1===(null==o?void 0:o.isIntersecting)?f.start("initial"):r.target===u.current?f.start(r.isIntersecting?"initial":"sticky"):r.target===s.current&&e(r.isIntersecting)}));return t.observe(s.current),t.observe(u.current),function(){return t.disconnect()}}}),[f,b]),Object(y.c)("div",{css:{position:"relative"},ref:a,children:[Object(y.b)(S.b,{content:{type:"Comment"},children:Object(y.b)(an,{disabled:t,autoFocus:n,placeholder:r,localCache:!0,css:{marginBottom:"10px"},onSubmit:o})}),c,b&&Object(y.b)("div",{ref:s,css:{position:"absolute",top:"100vh",bottom:0}}),t||b&&Object(y.c)(Le.a.div,{initial:"initial",animate:f,variants:{initial:{position:"relative",boxShadow:"0 0"},sticky:{position:"sticky",y:0,boxShadow:i?"0 0":"0px -1px 3px ".concat(Object(ie.a)(j).alpha(.12))},unSticky:{position:"sticky",y:"100%",boxShadow:"0 0"}},css:{margin:"0 -20px",padding:"10px 20px",bottom:0,background:g},children:[Object(y.b)(An,{}),Object(y.b)(S.b,{content:{type:"Comment"},children:Object(y.b)(an,{isSticky:!0,autoFocus:!1,placeholder:r,maxLine:6,onSubmit:o})})]}),b&&Object(y.b)("div",{ref:u})]})},In=function(e){var t=e.hide,n=e.disabled,r=e.autoFocus,o=e.placeholder,c=e.onAction,i=e.children,a=it(),s=a.displayType,u=a.fetchCommentId,l=a.rootCommentAuthor,d=l?"回复 ".concat(l.name):o,b=Object(T.a)((function(e){c("addComment",{data:e})}));return t?Object(y.b)(y.a,{children:i}):"list"===s?Object(y.b)(Bn,{disabled:n,autoFocus:r,placeholder:d,onSubmit:b,children:i}):Object(y.c)(y.a,{children:[i,Object(y.b)(S.b,{content:{type:"Comment"},children:Object(y.b)(an,{disabled:n,autoFocus:r,placeholder:d,maxLine:6,localCache:!0,replyCommentId:u,css:wn,onSubmit:b})})]})},Sn=function(e){var t=e.className,n=e.hideEditor,r=e.disableEditor,o=e.autoFocusEditor,c=e.editorPlaceholder,i=e.onAction,a=e.children,s=it(),u=s.displayType,l=s.commentType,d="root"!==l&&"sub"!==l||n;return Object(B.b)().Mobile?Object(y.b)(S.b,{block:"comment_list",children:Object(y.b)(I.Box,{className:t,children:Object(y.b)(I.Flex,{flexDirection:"column",alignItems:"stretch",sx:{position:"relative"},children:a})})}):"list"===u?Object(y.b)(S.b,{block:"comment_list",children:Object(y.b)(I.Box,{className:t,children:Object(y.b)(In,{hide:d,disabled:r,autoFocus:o,placeholder:c,onAction:i,children:Object(y.b)(I.Flex,{flexDirection:"column",alignItems:"stretch",sx:{position:"relative",border:"1px solid",borderColor:"GBK09A",borderRadius:"4px"},children:a})})})}):Object(y.b)(S.b,{block:"comment_popup",children:Object(y.b)(I.Flex,{flexDirection:"column",alignItems:"stretch",height:"100%",css:{position:"relative"},className:t,children:Object(y.b)(In,{hide:d,disabled:r,autoFocus:o,placeholder:c,onAction:i,children:a})})})},zn=function(e){var t,n,r,o,c,i,a=e.className,s=Object(C.useRef)(null),u=Object(B.b)(),l=u.Mobile,d=u.ZhihuHybrid,b=it(),p=b.index,f=b.displayType,m=b.commentType,h=b.sortType,O=b.prevLayerOffset,g=b.fetchCommentId,v="modal"===f,k="list"===f,w="root"===m,A="sub"===m,z="anchor"===m,E=function(){var e=it().commentType,t=Object(C.useMemo)((function(){return[["sub","anchor"].includes(e)?"root":e,"score",void 0,""]}),[e]),n=Object(D.a)(t),r=n.data,o=n.error,c=null==r?void 0:r.data;return t?o&&!c?{error:He(o)}:c?L()(r,"entities"):{error:"请求数据失败"}:{}}(),R=zt();c=R,i=0===p&&d,Object(C.useEffect)((function(){if(i){var e=Object(P.a)("comment/onMessage").listen((function(e){var t=e.type,n=e.data;c("changeComment",{type:t,data:n})})),t=Object(P.a)("base/viewDidAppear").listen((function(){c("clearWaiting")}));return function(){e(),t()}}}),[i,c]);var M=Boolean(v&&w&&O),G=z?g:void 0,N=Fe((function(){return[M&&O||""]}),[M,O,h]),F=x()(N,2),K=F[0],_=F[1],H=Object(T.a)((function(e){K.find((function(t){return t===e}))||_((function(t){return[].concat(j()(t),[e])}))})),U=Object(T.a)((function(){var e;v&&(null===(e=s.current)||void 0===e||e.scrollTo({top:0}))})),W=(null===(t=E.commentStatus)||void 0===t?void 0:t.type)||0;if(1===W||3===W)return Object(y.c)(Sn,{className:a,hideEditor:!0,onAction:R,children:[l&&Object(y.b)(Kt,{title:"评论"}),Object(y.b)(Et,{type:W})]});var V=null===(n=E.commentStatus)||void 0===n?void 0:n.induceText,Z=Boolean(E.error||V),J=w&&2===W;return 0===(null===(r=E.counts)||void 0===r?void 0:r.totalCounts)&&0===(null===(o=E.data)||void 0===o?void 0:o.length)?Object(y.c)(Sn,{className:a,disableEditor:Z,autoFocusEditor:!Z,editorPlaceholder:V,onAction:R,children:[l&&Object(y.b)(Kt,{title:"评论"}),J&&Object(y.b)(Tn,{type:"reviewing",counts:E.counts,isResourceAuthor:E.isContentAuthor,onAction:R}),Object(y.b)(Et,{noComments:!0})]}):Object(y.c)(Sn,{className:a,disableEditor:Z,editorPlaceholder:V,onAction:R,children:[Object(y.b)(Kt,{counts:E.counts,onChangeSortType:U}),Object(y.c)(S.f,{zaType:"Block",ref:s,css:{flex:"1 1 auto",overflowY:v?"scroll":void 0,position:"relative"},children:[A&&Object(y.b)(gn,{isResourceAuthor:E.isContentAuthor}),J&&Object(y.b)(Tn,{type:"reviewing",counts:E.counts,isResourceAuthor:E.isContentAuthor,onAction:R}),Object(y.c)(I.Box,{py:"10px",css:{minHeight:"100%"},children:[Boolean(M)&&Object(y.b)(Cn,{containerRef:s,commentType:m,pageOffset:"",isResourceAuthor:E.isContentAuthor,scrollAndBlink:"last"}),K.map((function(e,t){return Object(y.b)(Cn,{commentType:m,containerRef:s,fullHeightLoading:0===t&&M,scrollAndBlink:G,pageOffset:e,isResourceAuthor:E.isContentAuthor,isInfinite:l||v&&!z,onNextPage:H},e)}))]}),w&&Object(y.b)(Tn,{type:"collapsed",counts:E.counts,isResourceAuthor:E.isContentAuthor,onAction:R})]}),!l&&k&&K.length>0&&Object(y.b)(kn,{paging:E.paging})]})},Ln=function(e){var t=e.onClose,n=e.onExit,r=e.children,o=ot().pop,c=Object(T.a)((function(){t&&t(),o(0)}));return Object(y.b)(N.a,{size:"fullPage",css:{".Modal-content":{padding:0,marginTop:0,position:"relative"}},maskClosable:!1,onClose:c,onExitComplete:n,children:r})},En=function(e,t){return t<e-1?{display:"none"}:{}},Dn=function(e){var t=e.onExit,n=ot().layers,r=et(),o=r.className,c=r.displayType,i=r.onClose;if(Object(C.useEffect)((function(){"list"===c&&0===n.length&&t()}),[c,n.length,t]),"list"===c){var s=a()(n),u=s[0],l=s.slice(1);return u?Object(y.c)(y.a,{children:[Object(y.b)(ct,{data:u,children:Object(y.b)(zn,{className:o})}),Object(y.b)(Ln,{children:l.length>0?l.map((function(e,t){return Object(y.b)(ct,{data:e,children:Object(y.b)(zn,{css:En(l.length,t)})},e.index)})):null})]}):null}return Object(y.b)(Ln,{onClose:i,onExit:t,children:n.length>0?n.map((function(e,t){return Object(y.b)(ct,{data:e,children:Object(y.b)(zn,{css:En(n.length,t)})},e.index)})):null})},Rn=function(e){var t=e.shown,n=Object(C.useState)(t),r=x()(n,2),o=r[0],c=r[1],i=Object(T.a)((function(){c(!1)}));return Object(C.useEffect)((function(){t&&c(!0)}),[t]),o?Object(y.b)(Qe,Object.assign(Object.assign({},e),{},{children:Object(y.b)(Wt,{children:Object(y.b)(rt,{children:Object(y.b)(Dn,{onExit:i})})})})):null}}).call(this,n(245))}}]);
//# sourceMappingURL=column.lib_cf230269.c45264a937d8397af1fc.js.map